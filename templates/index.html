<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRG Organization</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=IM+Fell+English&display=swap');

    /* General Styling */
    body {
      font-family: 'IM Fell English', serif;
      margin: 0;
      padding: 0;
      color: #fff;
      text-align: center;
      background-color: black;
    }

    /* Pre‑Start (Entry) Screen – Evil Lair */
    #entry-screen {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      background-image: url('{{ url_for("static", filename="images/starting_background.jpeg") }}');
      background-size: cover;
      background-position: center;
    }

    /* Intro Screen with Disclaimer */
    #intro-screen {
      display: none;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      background-image: url('{{ url_for("static", filename="images/background_2.jpeg") }}');
      background-size: cover;
      background-position: center;
    }

    /* Loading Screen */
    #loading-screen {
      display: none;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      background-image: url('{{ url_for("static", filename="images/space_ocean.jpeg") }}');
      background-size: cover;
      background-position: center;
      color: white;
      text-align: center;
    }

    /* Chat Screen */
    #chat-screen {
      display: none;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      background-image: url('{{ url_for("static", filename="images/dirt_background.jpeg") }}');
      background-size: cover;
      background-position: center;
      color: white;
    }

    /* Title Styling */
    #entry-title, #intro-title, #chat-title, #loading-title {
      font-family: 'IM Fell English', serif;
      font-size: 28px;
      margin-bottom: 20px;
    }

    /* Disclaimer Box (Intro Screen) */
    #disclaimer-box, #loading-title-box {
      font-family: 'IM Fell English', serif;
      font-style: italic;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #ff6b6b;
      border-radius: 10px;
      padding: 20px;
      max-width: 600px;
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 20px;
      color: #ff6b6b;
      text-align: left;
      font-size: 16px;
      line-height: 1.6;
    }

    /* Buttons */
    #wanted-poster-button, #send-button, #enter-button {
      padding: 10px 20px;
      background-color: #ff6b6b;
      border: none;
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      margin-top: 10px;
    }
    #wanted-poster-button:hover, #send-button:hover, #enter-button:hover {
      background-color: #ff5252;
    }

    /* Loading Title Box */
    #loading-title-box {
      font-family: 'IM Fell English', serif;
      font-style: italic;
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.5);
      max-width: 600px;
      text-align: center;
      margin-bottom: 20px;
    }

    /* Progress Bar on Loading Screen */
    #progress-container {
      width: 80%;
      height: 20px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      overflow: hidden;
      margin-top: 20px;
    }
    #progress-bar {
      width: 0%;
      height: 100%;
      background-color: yellow;
      border-radius: 10px;
      transition: width 0.5s ease;
    }

    /* Burial Progress Bar (Now BELOW the chat wrapper) */
    #burial-progress-container {
      width: 80%;
      height: 20px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      overflow: hidden;
      margin: 20px auto 0;
    }
    #burial-progress-bar {
      width: 0%;
      height: 100%;
      background-color: yellow;
      border-radius: 10px;
      transition: width 0.5s ease;
    }

    /* Chat Wrapper: holds the instructions box and the chat container */
    #chat-wrapper {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
    }

    /* Instructions Box */
    #instructions-box {
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #ff6b6b;
      border-radius: 10px;
      padding: 20px;
      max-width: 300px;
      color: #ff6b6b;
      text-align: left;
      font-size: 16px;
    }
    #instructions-box h2 {
      font-family: 'IM Fell English', serif;
      font-size: 22px;
      margin-bottom: 10px;
    }
    #instructions-box ul {
      list-style-type: disc;
      padding-left: 20px;
    }
    #instructions-box li {
      font-family: 'IM Fell English', serif;
      font-style: italic;
      margin-bottom: 5px;
    }

    /* Chat Container */
    #chat-container {
      background: rgba(0, 0, 0, 0.9);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
      width: 450px;
      font-family: Calibri, sans-serif;
      margin: 0 auto;
    }
    #chat-title {
      font-family: 'IM Fell English', serif;
      font-size: 24px;
      color: #ff6b6b;
      font-weight: bold;
      margin-bottom: 15px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* Chat Log - ensure the white box is centered */
    #chat-log {
      border: 2px solid #ff6b6b;
      padding: 10px;
      width: 100%;
      height: 300px;
      overflow-y: auto;
      background: rgba(255, 255, 255, 0.9);
      color: #000;
      margin: 0 auto 10px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .message {
      max-width: 70%;
      padding: 10px;
      border-radius: 15px;
      font-size: 14px;
      line-height: 1.5;
    }
    .user-message {
      background-color: #d1e7ff;
      align-self: flex-end;
      color: #000;
    }
    .bot-message {
      background-color: #f1f1f1;
      align-self: flex-start;
      color: #000;
    }

    /* Chat Input */
    #user-input {
      width: calc(100% - 110px);
      padding: 10px;
      border: 2px solid #ff6b6b;
      border-radius: 10px;
      font-size: 14px;
      margin-right: 10px;
      outline: none;
    }

    /* Modal styling for Wanted Poster (kept as-is) */
    #wanted-poster-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.8);
    }
    #wanted-poster-modal-content {
      margin: 5% auto;
      padding: 20px;
      background: #fff;
      width: 90%;
      max-width: 1000px;
      border-radius: 10px;
      position: relative;
      text-align: center;
    }
    #wanted-poster-modal-content img {
      width: 100%;
      border-radius: 10px;
    }
    #close-wanted-poster {
      position: absolute;
      top: 10px;
      right: 15px;
      color: #000;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
    #modal-disclaimer {
      margin-top: 20px;
    }
    #modal-disclaimer p {
      font-family: 'IM Fell English', serif;
      font-style: italic;
      color: #000;
      margin: 0 0 10px;
      font-size: 18px;
    }
    #modal-disclaimer button {
      padding: 10px 20px;
      background-color: #ff6b6b;
      border: none;
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
    }
    #modal-disclaimer button:hover {
      background-color: #ff5252;
    }

    /* Modal styling for Congratulations Modal */
    #congrats-modal {
      display: none;
      position: fixed;
      z-index: 1100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.8);
    }
    #congrats-modal-content {
      margin: 5% auto;
      padding: 20px;
      background: #fff;
      width: 90%;
      max-width: 1000px;
      border-radius: 10px;
      position: relative;
      text-align: center;
    }
    #congrats-modal-content p {
      font-family: 'IM Fell English', serif;
      font-style: italic;
      color: #000;
      font-size: 18px;
      margin-bottom: 20px;
    }
    #offer-letter-button {
      padding: 10px 20px;
      background-color: #ff6b6b;
      border: none;
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
    }
    #offer-letter-button:hover {
      background-color: #ff5252;
    }
    #close-congrats-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      color: #000;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
    /* Offer Letter YouTube Modal */
    #offer-letter-modal {
      display: none;
      position: fixed;
      z-index: 1200;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.8);
    }
    #offer-letter-modal-content {
      margin: 5% auto;
      padding: 20px;
      background: #fff;
      width: 90%;
      max-width: 1000px;
      border-radius: 10px;
      position: relative;
      text-align: center;
    }
    #close-offer-letter-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      color: #000;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }


  </style>
</head>
<body>
  <!-- Audio Element (severance.mp3 plays continuously) -->
  <audio id="intro-loading-audio" src="{{ url_for('static', filename='audio/severance.mp3') }}" loop></audio>

  <!-- Pre‑Start (Entry) Screen – Evil Lair -->
  <div id="entry-screen">
    <div>
      <h1 id="entry-title">Are you ready to join forces with the Clown Rock Goddess?</h1>
      <button id="enter-button" onclick="enterLair()">yea yea</button>
    </div>
  </div>

  <!-- Intro Screen with Disclaimer -->
  <div id="intro-screen">
    <div>
      <h1 id="intro-title">Are you ready for your interview?</h1>
      <div id="disclaimer-box">
        The Clown Rock Goddess is a notorious sorceress that is proven to prey on innocent brains and brainwash them into aiding and abetting serious crimes, such as murder. She is known by various aliases, such as Varalika Varanasi, Vivi, Monkey 1, and Speedster. She is currently wanted for sorcery in all 195 countries of Planet Earth and countless more across the universe. This interview consists of you chatting with a simulated version of the CRG.<br>
        By accepting this interview, you may be subject to any number of criminal penalties, but please be reassured that this will only help your chances as the Clown Rock Goddess loves crimes. Please view her wanted poster below and proceed with caution.
      </div>
      <button id="wanted-poster-button" onclick="openWantedPoster()">Show Wanted Poster</button>
    </div>
  </div>

  <!-- Loading Screen -->
  <div id="loading-screen">
    <div id="loading-title-box">
      <h1 id="loading-title">
        Signal going through the deepest oceans<br>
        and through the seabed<br>
        to connect with a satellite in space
      </h1>
    </div>
    <div id="progress-container">
      <div id="progress-bar"></div>
    </div>
  </div>

  <!-- Chat Screen -->
  <div id="chat-screen">
    <!-- Chat Wrapper: contains the instructions box and the chat container -->
    <div id="chat-wrapper">
      <!-- Instructions Box -->
      <div id="instructions-box">
        <h2>Instructions</h2>
        <ul>
          <li>Please chat with a simulated version of the Clown Rock Goddess.</li>
          <li>Each submission will push your progress forward in this interview and will also be simultaneously performing a task in the real world.</li>
          <li>You must continue chatting with the chatbot till task completion no matter how repetitive or annoying the responses get.</li>
          <li>You may enter anything you want in the chatbot.</li>
          <li>Good luck!</li>
        </ul>
      </div>
      <!-- Chat Container -->
      <div id="chat-container">
        <h2 id="chat-title">Clown Rock Goddess Break Room</h2>
        <div id="chat-log"></div>
        <input type="text" id="user-input" placeholder="Type your message" onkeypress="handleKeyPress(event)" />
        <button id="send-button" onclick="sendMessage()">Send</button>
      </div>
    </div>
    <!-- Burial Progress Bar (Now BELOW the chat wrapper) -->
    <div id="burial-progress-container">
      <div id="burial-progress-bar"></div>
    </div>
  </div>

  <!-- Wanted Poster Modal -->
  <div id="wanted-poster-modal">
    <div id="wanted-poster-modal-content">
      <span id="close-wanted-poster" onclick="closeWantedPoster()">&times;</span>
      <img src="{{ url_for('static', filename='images/wanted_poster.jpeg') }}" alt="Wanted Poster" />
      <div id="modal-disclaimer">
        <p>Are you 100000% ready to interview for the Clown Rock Goddess? Once again, by clicking Kay Kay, you assume all legal responsibility for any offenses you are about to commit and resolve the Clown Rock Goddess or the Clown Rock Goddess Organization (CRG herself, Bluey, Winnie, Monkey 2) of any legal liability.</p>
        <button id="modal-kaykay-button" onclick="proceedToChat()">Kay Kay</button>
      </div>
    </div>
  </div>

  <!-- Congratulations Modal (Triggered at 50 responses) -->
  <div id="congrats-modal">
    <div id="congrats-modal-content">
      <span id="close-congrats-modal" onclick="closeCongratsModal()">&times;</span>
      <p>Congratulations, you successfully helped bury a dead body in the woods! The Clown Rock Goddess Organization is pleased with your performance and the Chief Technical Officer of the CRG Organization, Monkey 2, would like to invite you to join our organization. Please view our congratulatory note below.</p>
      <button id="offer-letter-button" onclick="viewOfferLetter()">View Offer Letter</button>
    </div>
  </div>
  <!-- Offer Letter Video Modal -->
  <div id="offer-letter-modal">
    <div id="offer-letter-modal-content">
      <span id="close-offer-letter-modal" onclick="closeOfferLetterModal()">&times;</span>
      <iframe id="offer-letter-iframe" width="100%" height="500" frameborder="0"
        allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
  </div>

  </div>

  <script>
    const backendUrl = "/chat"; // Flask backend endpoint
    let responseCount = 0;

    // Function triggered when the "yea yea" button is clicked on the entry screen.
    function enterLair() {
      document.getElementById("entry-screen").style.display = "none";
      document.getElementById("intro-screen").style.display = "flex";
      // Trigger the audio immediately.
      const audio = document.getElementById("intro-loading-audio");
      if (audio.paused) {
        audio.play().catch(err => console.log("Audio play failed:", err));
      }
    }

    function startLoading() {
      document.getElementById("intro-screen").style.display = "none";
      document.getElementById("loading-screen").style.display = "flex";

      const progressBar = document.getElementById("progress-bar");
      let progress = 0;

      const interval = setInterval(() => {
        progress += 10;
        progressBar.style.width = progress + "%";

        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            document.getElementById("loading-screen").style.display = "none";
            // Continue playing the same audio throughout.
            document.getElementById("chat-screen").style.display = "flex";
          }, 500);
        }
      }, 1000);
    }

    function sendMessage() {
      const userInput = document.getElementById("user-input").value;
      const chatLog = document.getElementById("chat-log");

      if (!userInput) return;

      // Add user message to chat log
      const userMessageElement = document.createElement("div");
      userMessageElement.classList.add("message", "user-message");
      userMessageElement.textContent = userInput;
      chatLog.appendChild(userMessageElement);

      // Scroll to the latest message
      chatLog.scrollTop = chatLog.scrollHeight;

      // Send user input to backend
      fetch(backendUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: userInput })
      })
        .then(response => response.json())
        .then(data => {
          // Add bot response to chat log
          const botMessageElement = document.createElement("div");
          botMessageElement.classList.add("message", "bot-message");
          botMessageElement.textContent = data.response;
          chatLog.appendChild(botMessageElement);

          // Scroll to the latest message
          chatLog.scrollTop = chatLog.scrollHeight;

          // Clear input
          document.getElementById("user-input").value = "";

          // Increase response count and update burial progress bar.
          responseCount++;
          const progressPercentage = Math.min(100, Math.round((responseCount / 50) * 100));
          document.getElementById("burial-progress-bar").style.width = progressPercentage + "%";

          // When 50 responses are reached, trigger the congratulations modal.
          if (responseCount === 50) {
            openCongratsModal();
          }
        })
        .catch(err => {
          const errorMessageElement = document.createElement("div");
          errorMessageElement.classList.add("message", "bot-message");
          errorMessageElement.textContent = "Error: Could not connect to the bot.";
          chatLog.appendChild(errorMessageElement);
          chatLog.scrollTop = chatLog.scrollHeight;
        });
    }

    function handleKeyPress(event) {
      if (event.key === "Enter") sendMessage();
    }

    // Functions for Wanted Poster Modal
    function openWantedPoster() {
      document.getElementById("wanted-poster-modal").style.display = "block";
    }
    function closeWantedPoster() {
      document.getElementById("wanted-poster-modal").style.display = "none";
    }
    function proceedToChat() {
      closeWantedPoster();
      startLoading();
    }

    // Functions for Congratulations Modal
    function openCongratsModal() {
      document.getElementById("congrats-modal").style.display = "block";
    }
    function closeCongratsModal() {
      document.getElementById("congrats-modal").style.display = "none";
    }
    
    function viewOfferLetter() {
      const modal = document.getElementById("offer-letter-modal");
      const iframe = document.getElementById("offer-letter-iframe");
    
      modal.style.display = "block";
    
      // Replace YOUR_VIDEO_ID with your actual YouTube video ID
      iframe.src = "https://www.youtube.com/embed/V_lrtfzchBo?autoplay=1";
    
      // Pause background audio
      const backgroundAudio = document.getElementById("intro-loading-audio");
      backgroundAudio.pause();
}

    function closeOfferLetterModal() {
      const modal = document.getElementById("offer-letter-modal");
      const iframe = document.getElementById("offer-letter-iframe");
    
      modal.style.display = "none";
    
      // Stop the video
      iframe.src = "";
    
      // Resume background audio
      const backgroundAudio = document.getElementById("intro-loading-audio");
      backgroundAudio.play().catch(err => console.log("Audio resume failed:", err));
    }


  </script>
</body>
</html>
